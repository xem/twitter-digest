<body id=b>
<a href=//github.com/xem/twitter-digest><img style="position:absolute;top:0;right:0;border:0;margin:0" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>
<h2>Twitter-digest</h2>
<input id="month" size=7 value="Jun .* 2019"><button id="go">GO</button>
<div id="tweets"></div>
<div id="digest">

<h2>DIGEST</h2>

<h3>COOL SITES</h3>
<ul id="digest_sites">
</ul>

<h3>WEB DEV</h3>
<ul id="digest_webdev">
</ul>

<h3>ART</h3>
<ul id="digest_art">
</ul>

<h3>GEEK</h3>
<ul id="digest_geek">
</ul>

<h3>CODEGOLF</h3>
<ul id="digest_codegolf">
</ul>

<h3>GAMEDEV</h3>
<ul id="digest_gamedev">
</ul>

<h3>FUN</h3>
<ul id="digest_fun">
</ul>

<h3>QUOTES</h3>
<ul id="digest_quotes">
</ul>

</div>
<style>

* { font-family: arial }
p { background: #f3f3f3; border: 1px solid #ddd; padding: 10px; width: 800px; margin: 10px 0 0; }
h6 { margin: 3px 0; padding: 0 }
img { max-height: 100px; max-width: 200px; margin: 5px 10px 5px 0; border: 1px solid #555; }
#digest { background: #f3f3f3; position: fixed; width: calc(100% - 1000px); height: calc(100% - 50px); top: 10px; left: 850px; border: 1px solid #ddd; padding: 10px; overflow: auto }
</style>

<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<script>
onload = function(){
  if(localStorage["twitterdigest"]){
    digest.innerHTML = localStorage["twitterdigest"];
  }
}

window.YTD = { tweet: [] };

go.onclick = function(){

  xhr = new XMLHttpRequest;
  xhr.open("GET", "tweet.js", 1);
  xhr.send();
  
  xhr.onload = function(){
  
    newindex = 0;
  
    //console.log(xhr.response);
    eval(xhr.response);
    tweets.innerHTML = "";
    html = "";
    //console.log(window.YTD.tweet.part0);
    reg = new RegExp(month.value);
    for(index = 0; index < window.YTD.tweet.part0.length; index++){
    
    
      i = window.YTD.tweet.part0[index];
    
      if(i.created_at.match(reg)){
        
        newindex++;
        
        console.log(i.created_at, i.id, newindex);
      
        setTimeout(
        
        `
        
          html = "";
          
          html += '<br><blockquote class="twitter-tweet"><a href="https://twitter.com/MaximeEuziere/status/${i.id}">June 6, 2019</a></blockquote> ';
          
          html = html + "<h6>"
          + "<a href=javascript:; onclick='add_item(${index-1}, digest_sites)'>SITE</a> - "
          + "<a href=javascript:; onclick='add_item(${index-1}, digest_webdev)'>WEBDEV</a> - "
          + "<a href=javascript:; onclick='add_item(${index-1}, digest_art)'>ART</a> - "
          + "<a href=javascript:; onclick='add_item(${index-1}, digest_geek)'>GEEK</a> - "
          + "<a href=javascript:; onclick='add_item(${index-1}, digest_codegolf)'>CODEGOLF</a> - "
          + "<a href=javascript:; onclick='add_item(${index-1}, digest_gamedev)'>GAMEDEV</a> - "
          + "<a href=javascript:; onclick='add_item(${index-1}, digest_fun)'>FUN</a> - "
          + "<a href=javascript:; onclick='add_item(${index-1}, digest_quotes)'>QUOTES</a>"
          + "</h6><br>";
          
          tweets.insertAdjacentHTML("beforeEnd", html);
          scr = document.createElement("SCRIPT");
          scr.src = 'https://platform.twitter.com/widgets.js';
          document.body.appendChild(scr);
        `,
        
        newindex * 300)
      }
    }
  }
}

add_item = function(index, container){
  
  text = document.querySelectorAll("twitter-widget")[index].shadowRoot.innerHTML.replace(/\s+/g," ").match(/<p class="Tweet-text e-entry-title" lang=".." dir="ltr">(.*?)<\/p>/g);
  
  text = text[text.length - 1].replace(/<p class="Tweet-text e-entry-title" lang=".." dir="ltr">/, "").replace("<\/p>", "");
  
  //console.log(text);
  
  container.innerHTML += "<li>" + text;
  
  localStorage["twitterdigest"] = digest.innerHTML;

}

oncontextmenu = function(e){

  //console.log(e);
  
  if(e.target.tagName == "LI"){
    if(confirm("delete?")){
      e.target.remove();
    }
  }
  e.preventDefault();
  localStorage["twitterdigest"] = digest.innerHTML;
}

</script>

